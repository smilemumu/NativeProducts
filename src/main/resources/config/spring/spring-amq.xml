<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jms="http://www.springframework.org/schema/jms"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd">
    <!--AMQ Queue Sender-->
    <bean id="amqConnFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL">
            <value>failover://(${mq.address})?randomize=false&amp;jms.useAsyncSend=true&amp;jms.prefetchPolicy.queuePrefetch=1000</value>
        </property>
    </bean>

    <bean id="jmsConnFactory" class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory" ref="amqConnFactory"/>
        <property name="sessionCacheSize" value="1"/>
    </bean>

    <!--JMS queue Template-->
    <bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
        <property name="connectionFactory" ref="jmsConnFactory"></property>
        <property name="defaultDestinationName" value="subject"></property>
        <property name="deliveryPersistent" value="false"></property>
        <property name="pubSubDomain" value="true"></property><!-- false p2p,true topic -->
        <property name="sessionAcknowledgeMode" value="3"></property>
        <property name="explicitQosEnabled" value="true"></property>
        <property name="timeToLive" value="600000"></property>
    </bean>

    <bean id="amqQueueSender" class="com.shibro.nativeproducts.utils.amq.AmqQueueSender">
        <property name="jmsTemplate" ref="jmsTemplate"></property>
    </bean>


    <!--AMQ Topic Receiver-->
    <bean id="amqConnFactory2" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL">
            <value>failover://(${lsp.lap.feedbck.mq.address})?randomize=false&amp;jms.useAsyncSend=true&amp;jms.prefetchPolicy.queuePrefetch=1000</value>
        </property>
    </bean>

    <bean id="jmsConnFactory2" class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory" ref="amqConnFactory2"/>
        <property name="sessionCacheSize" value="1"/>
    </bean>

    <bean id="topicReceiver" class="com.shibro.nativeproducts.utils.amq.AmqTopicReceiver"></bean>

    <!-- 定义Topic监听器容器 -->
    <jms:listener-container destination-type="topic" connection-factory="jmsConnFactory2">
        <jms:listener destination="${topic.listener}" ref="topicReceiver"/>
    </jms:listener-container>


    <!--AMQ Topic Sender-->
    <bean id="amqConnFactory3" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL">
            <value>failover://(${mq.address})?randomize=false&amp;jms.useAsyncSend=true&amp;jms.prefetchPolicy.queuePrefetch=1000</value>
        </property>
    </bean>

    <bean id="jmsConnFactory3"
          class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory" ref="amqConnFactory3"/>
        <property name="sessionCacheSize" value="100"/>
    </bean>

    <bean id="topicSender" class="com.shibro.nativeproducts.utils.amq.AmqTopicSender"></bean>

    <bean id="jmsTopicTemplate" class="org.springframework.jms.core.JmsTemplate">
        <constructor-arg ref="jmsConnFactory3"/>
        <property name="pubSubDomain" value="true"/>
        <property name="sessionAcknowledgeMode" value="3"></property>
        <property name="explicitQosEnabled" value="true"></property>
        <property name="timeToLive" value="600000"></property>
    </bean>

</beans>